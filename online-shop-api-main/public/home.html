<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Online-Shop</title>

    <style>
        .createlist {
            background: none;
            color: inherit;
            border: none;
            padding: 0;
            width: 150px;
            height: 150px;
        }

        .createlist:hover {
            background-color: lightgray;
        }

        .createlist img {
            max-width: 100%;
            height: auto;
        }

        .fixed-header {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        body {
            padding-top: 60px;
        }

        .logout-btn {
            position: absolute;
            right: 10px;
        }
    </style>

</head>

<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-header">
            <div class="container-fluid">
                <a class="navbar-brand mx-auto">Online-Shop</a>
                <button class="btn btn-danger logout-btn" onclick="location.href='index.html'">Abmelden</button>
            </div>
        </nav>
    </header>

    <h1 class="display-4 text-center">Produkte</h1>

    <div class="row">
        <div class="col-sm-6 mb-3 mb-sm-0">
            <div class="card ms-auto" style="width: 18rem;">
                <div class="card-body text-center">
                    <button type="button" class="createlist" onclick="createProduct()"> <img src="createicon.png"
                            alt=""> </button>
                </div>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="card me-auto" style="width: 18rem;">
                <div class="card-body text-center">
                    <button onclick="location.href = 'products.html';" class="createlist"> <img src="listicon.png"
                            alt=""> </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="createModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Produkt erstellen</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <div class="form-group">
                            <label for="productName">Name</label>
                            <input type="text" class="form-control" id="productName" placeholder="Name" required>
                        </div>
                        <div class="form-group">
                            <label for="productPrice">Preis</label>
                            <input type="number" class="form-control" id="productPrice" placeholder="Preis" required>
                        </div>
                        <div class="form-group">
                            <label for="productCategory">Kategorie</label>
                            <select class="form-control" id="productCategory" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="productImage">Bild URL</label>
                            <input type="url" class="form-control" id="productImage" placeholder="Bild URL">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="saveProduct()">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <h1 class="display-4 text-center">Kategorien</h1>

    <div class="row">
        <div class="col-sm-6 mb-3 mb-sm-0">
            <div class="card ms-auto" style="width: 18rem;">
                <div class="card-body text-center">
                    <button type="button" class="createlist" onclick="createCategorie()"> <img src="createicon.png"
                            alt=""> </button>
                </div>
            </div>
        </div>
        <div class="col-sm-6 me-auto" style="width: 19rem;">
            <div class="card">
                <div class="card-body text-center">
                    <button onclick="location.href = 'categories.html';" class="createlist"> <img src="listicon.png"
                            alt=""> </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="createModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Kategorie erstellen</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="categoryForm">
                        <div class="form-group">
                            <label for="categoryName">Name</label>
                            <input type="text" class="form-control" id="categoryName" placeholder="Name" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="saveCategory()">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        /**
         * Zeigt das Modal zur Produkterstellung an und lädt die Kategorien.
         */
        function createProduct() {
            const createModal = document.getElementById('createModal');
            const modal = new bootstrap.Modal(createModal);
            modal.show();
            fetchCategories();
        }

        /**
         * Zeigt das Modal zur Kategorierstellung an.
         */
        function createCategorie() {
            const createModal2 = document.getElementById('createModal2');
            const modal = new bootstrap.Modal(createModal2);
            modal.show();
        }

        /**
         * Ruft die Kategorien vom Server ab und füllt die Auswahlbox für Produktkategorien.
         */
        function fetchCategories() {
            fetch('/categories')
                .then(response => response.json())
                .then(categories => {
                    const select = document.getElementById('productCategory');
                    select.innerHTML = categories.map(category => `<option value="${category.id}">${category.name}</option>`).join('');
                })
                .catch(error => console.error('Fehler beim Abrufen der Kategorien:', error));
        }

        /**
         * Speichert eine neue Kategorie, indem eine POST-Anfrage an den Server gesendet wird.
         */
        function saveCategory() {
            const categoryName = document.getElementById('categoryName').value;

            const categoryData = {
                name: categoryName
            };

            fetch('/categories', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                },
                body: JSON.stringify(categoryData)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erstellen der Kategorie fehlgeschlagen');
                    }
                    return response.json();
                })
                .then(data => {
                    alert('Kategorie erfolgreich erstellt');
                    const createModal = document.getElementById('createModal2');
                    const modal = bootstrap.Modal.getInstance(createModal);
                    modal.hide();
                    fetchCategories();
                })
                .catch(error => {
                    console.error('Fehler beim Erstellen der Kategorie:', error);
                    alert('Erstellen der Kategorie fehlgeschlagen');
                });
        }

        /**
         * Speichert ein neues Produkt, indem eine POST-Anfrage an den Server gesendet wird.
         */
        function saveProduct() {
            const productName = document.getElementById('productName').value;
            const productPrice = document.getElementById('productPrice').value;
            const productCategory = document.getElementById('productCategory').value;
            const productImage = document.getElementById('productImage').value;

            const productData = {
                name: productName,
                price: parseFloat(productPrice),
                categoryId: parseInt(productCategory),
                image: productImage
            };

            fetch('/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                },
                body: JSON.stringify(productData)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erstellen des Produkts fehlgeschlagen');
                    }
                    return response.json();
                })
                .then(data => {
                    alert('Produkt erfolgreich erstellt');
                    const createModal = document.getElementById('createModal');
                    const modal = bootstrap.Modal.getInstance(createModal);
                    modal.hide();
                })
                .catch(error => {
                    console.error('Fehler beim Erstellen des Produkts:', error);
                    alert('Erstellen des Produkts fehlgeschlagen');
                });
        }
    </script>

</body>

</html>